\documentclass{article}
\usepackage[ae,hyper]{Rd}
\begin{document}
\Rdcontents{R package \bold{npmlreg} -- Manual}


\HeaderA{alldist}{NPML estimation or Gaussian quadrature for overdispersed GLM's and variance component models}{alldist}
\aliasA{allvc}{alldist}{allvc}
\keyword{models}{alldist}
\keyword{regression}{alldist}
\begin{Description}\relax
Fits a random effect model using Gaussian quadrature (Hinde, 1982) or nonparametric maximum likelihood (Aitkin, 1996a).
The function \code{alldist} is designed to account for overdispersion, while \code{allvc} fits variance component models.
\end{Description}
\begin{Usage}
\begin{verbatim}
alldist(formula,
        random = ~1,
        family = gaussian(),
        data,
        k = 4,
        random.distribution = "np",
        tol = 0.5,
        offset,
        weights,
        pluginz,
        na.action,
        EMmaxit = 500,
        EMdev.change = 0.001,
        lambda = 0,
        damp = TRUE,
        damp.power = 1,
        spike.protect = 0,
        sdev,
        shape,
        plot.opt = 3,
        verbose = TRUE,
        ...)

allvc(formula,
        random = ~1,
        family = gaussian(),
        data,
        k = 4,
        random.distribution = "np",
        tol = 0.5,
        offset,
        weights,
        pluginz,
        na.action,
        EMmaxit = 500,
        EMdev.change = 0.001,
        lambda=0,
        damp = TRUE,
        damp.power = 1,
        spike.protect=0,
        sdev,
        shape,
        plot.opt = 3,
        verbose = TRUE,
        ...)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{formula}] a formula defining the response and the fixed effects (e.g. \code{y \textasciitilde{} x}).
\item[\code{random}] a formula defining the random model. In the case of \code{alldist},  set \code{random = \textasciitilde{}1} to model overdispersion, and for instance \code{random = \textasciitilde{}x} to introcude a random coeffcient \code{x}.
In the case of \code{allvc},  set \code{random=\textasciitilde{}1|PSU} to model overdispersion on the upper level, where PSU is a \bold{factor} for the primary sampling units, e.g. groups, clusters, classes, or individuals in longitudinal data, and define random coefficents accordingly.
\item[\code{family}] conditional distribution of responses. "gaussian", "poisson", "binomial", or "Gamma" can be set. If "gaussian" or "Gamma", then equal component dispersion parameters are assumed, except if the optional parameter lambda is modified.
\item[\code{data}] the data frame (mandatory, even if it is attached to the workspace!).
\item[\code{k}] the number of mass points/integration points
(supported are up to 30 mass points).
\item[\code{random.distribution}] the mixing distribution, Gaussian Quadrature (\code{gq}) or NPML (\code{np}) can be set.
\item[\code{tol}] the tol scalar (usually, \eqn{0<}{}\code{tol} \eqn{\le 1}{<= 1})
\item[\code{offset}] an optional offset to be included in the model.
\item[\code{weights}] optional prior weights for the data.
\item[\code{pluginz}] optional numerical vector of length \code{k} specifying the starting mass points of the EM algorithm.
\item[\code{na.action}] a function indicating what should happen when \code{NA}'s occur,
with possible arguments \code{na.omit} and \code{na.fail}. The default is set
by the \code{na.action} setting in \code{options()}.
\item[\code{EMmaxit}] maximum number of EM iterations.
\item[\code{EMdev.change}] stops EM algorithm when deviance change falls below this value.
\item[\code{lambda}] only applicable for Gaussian and Gamma mixtures. If set, standard
deviations/ shape parameters are calculated smoothly across components via
a Aitchison-Aitken kernel (\code{\LinkA{dkern}{dkern}}) with parameter \code{lambda}.
The setting \code{lambda= 0} is automatically mapped to \code{lambda =1/k} and
corresponds to the case 'maximal smoothing' (i.e. equal component dispersion parameters),
while \code{lambda=1} means 'no smoothing' (unequal disp. param.)
\item[\code{damp}] switches EM damping on or off.
\item[\code{damp.power}] steers degree of damping applied on dispersion parameter according
to formula \code{1-(1-tol)\textasciicircum{}(damp.power*iter+1)}, see Einbeck \& Hinde (2005).
\item[\code{spike.protect}] protects algorithm to converge into likelihood spikes for
Gaussian and Gamma mixtures with unequal or smooth component standard deviations,
by stopping the EM algorithm if one of the component standard deviations
(shape parameters, resp.), divided by the fitted mass points, falls below
(exceeds, resp.) a certain threshold, which is \code{0.000001*spike.protect}
(\code{10\textasciicircum{}6*spike.protect}, resp.) Setting \code{spike.protect=0} means
disabling the spike protection. If set, then \code{spike.protect=1}
is recommended. Note that the displayed disparity may not be correct
when convergence is not achieved. This can be checked with \code{EMconverged}.
\item[\code{sdev}] optional; specifies standard deviation for normally distributed response.
If unspecified, it will be estimated from the data.
\item[\code{shape}] optional; specifies shape parameter for gamma-distributed response.
Setting \code{shape=1} gives an exponential distribution. If unspecified,
it will be estimated from the data.
\item[\code{plot.opt}] if equal to zero, then no graphical output is given.
For \code{plot.opt=1} the development of the disparity \eqn{-2\log L}{-2logL} over
iteration number is plotted, for \code{plot.opt=2} the EM trajectories are plotted,
and for \code{plot.opt=3} both plots are shown.
\item[\code{verbose}] if set to \code{FALSE}, no printed output is given during
function execution. Useful for \code{tolfind}.
\item[\code{...}] generic options for the \code{glm} function. Not all options may
be supported under any circumstances.
\end{ldescription}
\end{Arguments}
\begin{Details}\relax
The nonparametric maximum likelihood (NPML) approach was introduced in Aitkin (1996)
as a tool to fit overdispersed generalized linear models. The idea is to approximate
the unknown and unspecified distribution of the random effect by a discrete mixture
of exponential family densities, leading to a simple expression of the marginal
likelihood which can then be maximized using a standard EM algorithm.

Aitkin (1999) extended this method to generalized linear models with shared
random effects arising through variance component or repeated measures
structure. Applications are two-stage sample designs, when firstly the
primary sampling units (the upper-level units, e.g. classes) and then the
secondary sampling units (lower-level units, e.g. students) are selected, or
longitudinal data. Models of this type have also been referred to as multi-level
models (Goldstein, 2003). \code{allvc} is restricted to 2-level models.

The number of components \code{k} of the finite mixture has to be specified beforehand.
When option \code{'gq'} is set, then Gauss-Hermite masses and mass points are used,
assuming implicitly a normally distributed random effect.
When option \code{'np'} is chosen, the EM algorithm uses the Gauss-Hermite masses
and mass points as starting points. The position of the starting points can
be concentrated or extended by setting \code{tol} smaller or larger than one,
respectively.

Fitting random coefficient models (Aitkin, Francis \& Hinde, 2005, pp. 474, p. 491) is
possible by specifying the random term explicitly. Note that the setting
\code{random= \textasciitilde{} x} gives a model with a random slope and a random intercept,
that only one random coefficient can be specified, and that the option
\code{random.distribution} is restricted to \code{np} in this case.

The weights have to be understood as frequency weights, i.e. setting all weights in
\code{alldist} equal to 2 will duplicate each data point and hence double the
disparity and deviance.
\end{Details}
\begin{Value}
The function alldist produces an object of class \code{glmmNPML}
(if \code{random.distributon} is set to \code{np})  or \code{glmmGQ}
(\code{gq}).  Both objects contain the following 29 components:

\begin{ldescription}
\item[\code{coefficients}] a named vector of coefficients (including the mass points).
In case of Gaussian quadrature, the coefficient given at \code{z}
corresponds to the standard deviation of the mixing distribution.
\item[\code{residuals}] the difference between the true response and the emprical Bayes predictions.
\item[\code{fitted.values}] the empirical Bayes predictions (Aitkin, 1996b) on the scale of the responses.
\item[\code{family}] the `family' object used.
\item[\code{linear.predictors}] the extended linear predictors \eqn{\hat{\eta}_{ik}}{eta_ik}.
\item[\code{disparity}] the disparity (\code{-2logL}) of the fitted mixture regression model.
\item[\code{deviance}] the deviance of the fitted mixture regression model.
\item[\code{null.deviance}] The deviance for the null model (just containing an intercept), comparable with
`deviance'.
\item[\code{df.residual}] the residual degrees of freedom of the fitted model (including the random part).
\item[\code{df.null}] the residual degrees of freedom for the null model.
\item[\code{y}] the (extended) response vector.
\item[\code{call}] the matched call.
\item[\code{formula}] the formula supplied.
\item[\code{random}] the random term of the model formula.
\item[\code{data}] the data argument.
\item[\code{model}] the (extended) design matrix.
\item[\code{weights}] the case weights initially supplied.
\item[\code{offset}] the offset initially supplied.
\item[\code{mass.points}] the fitted mass points.
\item[\code{masses}] the mixture probabilities corresponding to the mass points.
\item[\code{sdev}] a list of the two elements \code{sdev\$sdev} and \code{sdev\$sdevk}.
The former is the (overall)  standard deviation of a Gaussian mixture (identical
to the value \code{MLE of sigma} provided in the summary), and the latter
gives the unequal or smooth component-specific standard deviations.
All values are equal if \code{lambda=0}.
\item[\code{shape}] a list of the two elements \code{shape\$shape} and \code{shape\$shapek},
to be interpreted in analogy to sdev.
\item[\code{post.prob}] a matrix of posteriori probabilities.
\item[\code{post.int}] a vector of `posteriori intercepts' (as in Sofroniou et al. (2006)).
\item[\code{ebp}] the empirical Bayes Predictions on the scale of the linear predictor.
For compatibility with older versions.
\item[\code{EMiter}] gives the number of iterations of the EM algorithm.
\item[\code{EMconverged}] logical value indicating if the EM algorithm converged.
\item[\code{lastglm}] the fitted \code{glm} object from the last EM iteration.
\item[\code{Misc}] contains additional information relevant for the summary and plot functions,
in particular the disparity trend and the EM trajectories.
\end{ldescription}


If a binomial model is specified by giving a two-column response,
the weights returned by \code{weights} are the total numbers of cases
(factored by the supplied case weights) and the component \code{y}
of the result is the proportion of successes.

As a by-product, \code{alldist} produces a plot showing the disparity
in dependence of the iteration number. Further, a plot with the EM trajectories
is given. The x-axis corresponds  to the iteration number, and the y-axis
to the value of the mass points at a particular iteration.
This plot is not produced for GQ.
\end{Value}
\begin{Note}\relax
In contrast to the GLIM 4 version, this \R{} implementation
uses for Gaussian and Gamma mixtures by default a damping procedure in the
first cycles of the EM algorithm (Einbeck \& Hinde, 2006), which stabilizes
the algorithm and makes it less sensitive to the optimal
choice of \code{tol}. If \code{tol} is very small
(i.e. less than 0.1), it can be useful  to set \code{damp.power} to values
larger than 1 in order to accelerate convergence.
Do not use \code{damp.power=0}, as this would mean permanent damping during EM.
Using the option \code{pluginz}, one  can to some extent circumvent the
necessity to  specify \code{tol} by giving the starting points explicitly.
However, when using \code{pluginz} for normal or gamma-distributed response,
damping will be strictly necessary to ensure that the imposed starting points
don't get blurred immediately due to initial fluctuations, implying that
\code{tol} still plays a role in this case.
\end{Note}
\begin{Author}\relax
Originally translated from the GLIM 4 functions \code{alldist} and
\code{allvc} (Aitkin \& Francis, 1995) to \R{} by Ross Darnell (2002). Modified,
extended, and prepared for publication by Jochen Einbeck \& John Hinde (2006).
\end{Author}
\begin{References}\relax
Aitkin, M. and Francis, B. (1995). Fitting overdispersed generalized linear models by nonparametric maximum likelihood. GLIM Newsletter 25, 37-45.

Aitkin, M. (1996a). A general maximum likelihood analysis of overdispersion in generalized linear models. Statistics and Computing 6, 251-262.

Aitkin, M. (1996b). Empirical Bayes shrinkage using posterior random effect means from nonparametric maximum likelihood estimation in general random effect models. Statistical Modelling: Proceedings of the 11th IWSM 1996, 87-94.

Aitkin, M. (1999). A general maximum likelihood analysis of variance components in generalized linear models. Biometrics 55, 117-128.

Aitkin, M., Francis, B. and Hinde, J. (2005). Statistical Modelling in GLIM 4. Second Edition, Oxford Statistical Science Series, Oxford, UK.

Einbeck, J. \& Hinde, J. (2006). A note on NPML estimation for exponential family regression models with unspecified dispersion parameter. Austrian Journal of Statistics 35, 233-243.

Goldstein, H. (2003). Multilevel Statistical Models (3rd edition). Arnold, London, UK.

Hinde, J. (1982). Compound Poisson regression models. Lecture Notes in Statistics 14, 109-121.

Sofroniou, N., Einbeck, J., and Hinde, J. (2006). Analyzing Irish suicide rates with mixture models. Proceedings of the 21st International Workshop on Statistical Modelling in Galway, Ireland, 2006.
\end{References}
\begin{SeeAlso}\relax
\code{\LinkA{glm}{glm}}, \code{\LinkA{summary.glmmNPML}{summary.glmmNPML}},
\code{\LinkA{predict.glmmNPML}{predict.glmmNPML}} \code{\LinkA{family.glmmNPML}{family.glmmNPML}},
\code{\LinkA{plot.glmmNPML}{plot.glmmNPML}}.
\end{SeeAlso}
\begin{Examples}
\begin{ExampleCode}

# The first three examples (galaxy data, toxoplasmosis data , fabric faults)
# are based on GLIM examples in Aitkin et al. (2005), and the forth example using
# the Hospital-Stay-Data (Rosner, 2000) is taken from Einbeck & Hinde (2006).
# The fifth data example using the Oxford boys is again inspired by Aitkin et al. (2005).
# The sixth example on Irish suicide rates is taken from Sofroniou et al. (2006).


# The galaxy data
  data(galaxies, package="MASS")
  gal<-as.data.frame(galaxies)
  galaxy.np6 <- alldist(galaxies/1000~1, random=~1, random.distribution="np",
      data=gal, k=6)
  galaxy.np8u <- alldist(galaxies/1000~1, random=~1, random.distribution="np",
      data=gal, k=8, lambda=0.99)
  round(galaxy.np8u$sdev$sdevk, digits=3)
  #[1] 0.906 0.435 0.218 0.676 1.205 0.216 0.412 0.295

# The toxoplasmosis data
  data(rainfall, package="forward")
  rainfall$x<-rainfall$Rain/1000
  rainfall$x2<- rainfall$x^2; rainfall$x3<- rainfall$x^3
  toxo.np3<- alldist(cbind(Cases,Total-Cases) ~ x+x2+x3, random=~1,
      random.distribution="np", family=binomial(link=logit), data=rainfall, k=3)
  toxo.np3x<- alldist(cbind(Cases,Total-Cases) ~ x, random=~x,
      random.distribution="np", family=binomial(link=logit), data=rainfall, k=3)
  #is the same as
  toxo.np3x<- alldist(Cases/Total ~ x, random = ~x, weights=Total,
      family=binomial(link=logit), data=rainfall, k=3)
  #or
  toxo.np3x<-update(toxo.np3, .~.-x2-x3, random = ~x)

# The fabric faults data
  data(fabric, package="gamlss")
  coefficients(alldist(y ~ x, random=~1, family=poisson(link=log),
      random.distribution="gq", data= fabric, k=3, verbose=FALSE))
  #(Intercept)           x           z
  # -3.3088663   0.8488060   0.3574909

# The Pennsylvanian hospital stay data
  data(hosp)
  fitnp3<-  alldist(duration~age+temp1, data=hosp, k=3, family=Gamma(link=log),
      tol=0.5)
  fitnp3$shape$shape
  #[1] 50.75232
  fitnp3<-  alldist(duration~age+temp1, data=hosp, k=3, family=Gamma(link=log),
      tol=0.5, lambda=0.9)
  fitnp3$shape$shapek
  #[1]  49.03108  42.79532 126.64046

# The Oxford boys data
  data(Oxboys, package="nlme")
  Oxboys$boy <- gl(26,9)
  allvc(height~age, random=~1|boy, data=Oxboys, random.distribution='gq', k=20)
  allvc(height~age, random=~1|boy, data=Oxboys,random.distribution='np',k=8)
  #with random coefficients:
  allvc(height~age,random=~age|boy, data=Oxboys, random.distribution='np', k=8)

# Irish suicide data
  data(irlsuicide)
  # Crude rate model:
  crude<- allvc(death~sex* age, random=~1|ID, offset=log(pop),
      k=3, data=irlsuicide, family=poisson)
  crude$disparity
  # [1] 654.021
  # Relative risk model:
  relrisk<- allvc(death~1, random=~1|ID, offset=log(expected),
      k=3, data=irlsuicide, family=poisson)
  relrisk$disparity
  # [1] 656.4955

\end{ExampleCode}
\end{Examples}

\HeaderA{dkern}{Aitchison-Aitken kernel}{dkern}
\keyword{models}{dkern}
\keyword{regression}{dkern}
\begin{Description}\relax
Discrete kernel for categorical data  with \code{k} unordered categories.
\end{Description}
\begin{Usage}
\begin{verbatim}
dkern(x, y, k, lambda)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{x}] categorical data vector
\item[\code{y}] postive integer defining a fixed category
\item[\code{k}] positive integer giving the number of categories
\item[\code{lambda}] smoothing parameter
\end{ldescription}
\end{Arguments}
\begin{Details}\relax
This kernel was introduced in Aitkinson \& Aitken (1976); see also Titterington (1980).

The setting \code{lambda =1/k} corresponds to the extreme case 'maximal smoothing',
while \code{lambda = 1} means `no smoothing'. Statistically sensible settings are
only \code{1/k}\eqn{\le}{<=} \code{lambda} \eqn{\le}{<=}\code{1}.
\end{Details}
\begin{Author}\relax
Jochen Einbeck (2006)
\end{Author}
\begin{References}\relax
Aitchison, J. and Aitken, C.G.G. (1976). Multivariate binary discrimination by kernel
method. Biometrika 63, 413-420.

Titterington, D. M. (1980). A comparative study of kernel-based density estimates for
categorical data.  Technometrics, 22, 259-268.
\end{References}
\begin{Examples}
\begin{ExampleCode}

k<-6;
dkern(1:k,4,k,0.99)
# Kernel centered at the 4th component with a very small amount of smoothing.

## The function is currently defined as
function(x,y,k,lambda){
ifelse(y==x, lambda, (1-lambda)/(k-1))
  }
\end{ExampleCode}
\end{Examples}

\HeaderA{family.glmmNPML}{Generic functions for objects of class glmmNPML or glmmGQ}{family.glmmNPML}
\aliasA{family.glmmGQ}{family.glmmNPML}{family.glmmGQ}
\aliasA{model.matrix.glmmGQ}{family.glmmNPML}{model.matrix.glmmGQ}
\aliasA{model.matrix.glmmNPML}{family.glmmNPML}{model.matrix.glmmNPML}
\keyword{models}{family.glmmNPML}
\keyword{regression}{family.glmmNPML}
\begin{Description}\relax
Methods for the generic \code{family} and \code{model.matrix} functions
\end{Description}
\begin{Usage}
\begin{verbatim}
family.glmmNPML(object, ...)
family.glmmGQ(object, ...)
model.matrix.glmmNPML(object, ...)
model.matrix.glmmGQ(object, ...)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{object}] object of class \code{glmmNPML} or \code{glmmGQ}.
\item[\code{...}] further arguments, ensuring compability with generic functions.
\end{ldescription}
\end{Arguments}
\begin{Note}\relax
The generic \R{} functions \code{update()}, \code{coefficients()},  \code{coef()},
\code{fitted()}, \code{fitted.values()}, and \code{df.residual()}
can also be applied straightforwardly on all objects of
class \code{glmmNPML} or \code{glmmGQ}.  They are not listed above as they use
the generic default functions  and are not separately implemented.

Explicit implementations exist for \code{predict},  \code{summary},
\code{print}, and \code{plot}, and these functions are explained in the corresponding
help files.
\end{Note}
\begin{Author}\relax
Jochen Einbeck and John Hinde (2006)
\end{Author}
\begin{SeeAlso}\relax
\code{\LinkA{summary.glmmNPML}{summary.glmmNPML}}, \code{\LinkA{predict.glmmNPML}{predict.glmmNPML}},
\code{\LinkA{family}{family}}, \code{\LinkA{model.matrix}{model.matrix}}, \code{\LinkA{update}{update}},
\code{\LinkA{coefficients}{coefficients}}, \code{\LinkA{alldist}{alldist}}.
\end{SeeAlso}

\HeaderA{gqz}{Gauss-Hermite integration points}{gqz}
\keyword{models}{gqz}
\keyword{regression}{gqz}
\begin{Description}\relax
Calculate Gaussian Quadrature points for the Normal distribution
using the abscissas and weights for Hermite integration.
\end{Description}
\begin{Usage}
\begin{verbatim}
gqz(numnodes=20, minweight=0.000001)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{numnodes}] theoretical number of quadrature points.
\item[\code{minweight}] locations with weights that are less than this value will be omitted.
\end{ldescription}
\end{Arguments}
\begin{Details}\relax
The  conversion of the locations and weights is given in Lindsey (1992,
page 169:3) and Skrondal \& Rabe-Hesketh (2004, page 165:1).
The argument numnodes is the theoretical number of quadrature points,
locations with weights that are less than the argument \code{minweight} will
be omitted. The default value of \code{minweight=0.000001} returns 14 masspoints
for the default \code{numnodes=20} as in Aitkin, Francis \& Hinde (2005).
\end{Details}
\begin{Value}
A list with two vectors:
\begin{ldescription}
\item[\code{location}] locations of mass points
\item[\code{weight}] masses
\end{ldescription}
\end{Value}
\begin{Author}\relax
Nick Sofroniou (2005)
\end{Author}
\begin{References}\relax
Aitkin, M., Francis, B. and Hinde, J. (2005). Statistical Modelling in GLIM 4.
Second Edition, Oxford Statistical Science Series, Oxford, UK.

Lindsey, J. K. (1992). The Analysis of Stochastic Processes using GLIM.
Berlin: Springer-Verlag.

Skrondal, A. and Rabe-Hesketh, S. (2004). Generalized
latent variable modelling. Boca Raton: Chapman and Hall/CRC.
\end{References}
\begin{SeeAlso}\relax
\code{\LinkA{alldist}{alldist}}, \code{\LinkA{allvc}{allvc}}
\end{SeeAlso}
\begin{Examples}
\begin{ExampleCode}
gqz(20, minweight=1e-14)
  # gives 20 GH mass points, as used as EM starting points for k=20
  # in alldist  and allvc
\end{ExampleCode}
\end{Examples}

\HeaderA{hosp}{The Pennsylvanian Hospital Stay Data}{hosp}
\keyword{datasets}{hosp}
\begin{Description}\relax
The data, 25 observations, are a subset from a larger data set collected
on persons discharged from a selected Pennsylvania hospital as part of a
retrospective chart review of antibiotic use in hospitals (Towensend et al.,
1979, Rosner, 2000).
\end{Description}
\begin{Usage}
\begin{verbatim}data(hosp)\end{verbatim}
\end{Usage}
\begin{Format}\relax
A data frame with 25 observations on the following 9 variables. All variables
are given as numerical vectors.
\describe{
\item[\code{id}] patient ID.
\item[\code{duration}] the total number of days patients
spent in hospital.
\item[\code{age}] age of patient in whole years.
\item[\code{sex}] gender: 1=M, 2=F.
\item[\code{temp1}] first temperature following admission.
\item[\code{wbc1}] first WBC count (\eqn{\times 10^3}{x10^3}) following admission. [WBC= white blood cells].
\item[\code{antib}] received antibiotic: 1=yes, 2=no.
\item[\code{bact}] received bacterial culture: 1=yes, 2=no.
\item[\code{serv}] service: 1 =med., 2=surg.
}
\end{Format}
\begin{Section}{Warnings}
Don't confuse with the Barcelona 'Hospital stay data' \code{aep} in package \pkg{gamlss}.
\end{Section}
\begin{Source}\relax
B. Rosner, Harvard University.
\end{Source}
\begin{References}\relax
Rosner, B. (2000). Fundamentals of Biostatistics. Thomson Learning, Duxbury, CA, USA.

Townsend, T.R., Shapiro, M., Rosner, B., \& Kass, E. H. (1979). Use of antimicrobial drugs in general hospitals. I. Description of population and definition of methods. Journal of Infectious Diseases 139 , 688-697.
\end{References}
\begin{Examples}
\begin{ExampleCode}
data(hosp)
glm(duration~age+temp1+wbc1, data=hosp)
\end{ExampleCode}
\end{Examples}

\HeaderA{irlsuicide}{Irish Suicide Data}{irlsuicide}
\keyword{datasets}{irlsuicide}
\begin{Description}\relax
Suicide Rates in the Republic of Ireland 1989-1998.
\end{Description}
\begin{Usage}
\begin{verbatim}data(irlsuicide)\end{verbatim}
\end{Usage}
\begin{Format}\relax
A data frame with 104 observations on the following 8 variables.
\describe{
\item[\code{Region}] a factor with levels \code{Cork }, \code{Dublin }, \code{EHB - Dub.}, \code{Galway}, \code{Lim.}, \code{Mid HB}, \code{MWHB-Lim.}, \code{NEHB}, \code{NWHB}, \code{SEHB-Wat.}, \code{SHB-Cork}, \code{Waterf.}, \code{WHB-Gal.}.
\item[\code{ID}] a factor with levels \code{1} \code{2} \code{3} \code{4} \code{5} \code{6} \code{7} \code{8} \code{9} \code{10} \code{11} \code{12} \code{13} correspomnding to Regions.
\item[\code{pop}] a numeric vector giving the population sizes (estimated for 1994).
\item[\code{death}] a numeric vector giving the total number of deaths.
\item[\code{sex}] a factor for gender with levels \code{0} (female) and \code{1} (male).
\item[\code{age}] a factor for age with levels \code{1} (0-29),  \code{2} (30-39), \code{3} (40-59), \code{4} (60+ years).
\item[\code{smr}] a numeric vector with standardized mortality  ratios (SMRs)
\item[\code{expected}] a numeric vector with `expected' number of cases obtained from a reference population (Ahlbom, 1993).
}
\end{Format}
\begin{Details}\relax
The data set is  examined in Sofroniou et al. (2006), using a variance component model
with regions as upper level.
\end{Details}
\begin{Source}\relax
Institute of Public Health in Ireland (2005). All
Ireland Mortality Database. Retrieved August 8, 2005,
from \url{http://mapserver1.cdc-ni.com/iph/index.htm}.
\end{Source}
\begin{References}\relax
Ahlbom, A.,  (1993). Biostatistics for Epidemiologists. Boca Raton: Lewis Publishers.

Sofroniou, N., Einbeck, J., and Hinde, J. (2006). Analyzing Irish Suicide Rates with Mixture Models.
Proceedings of the 21st Workshop on Statistical Modelling in Galway, Ireland, 2006.
\end{References}
\begin{Examples}
\begin{ExampleCode}
data(irlsuicide)
library(lattice)
trellis.device(color=FALSE)
plot2age<-rep(gl(4,2),13)
xyplot(irlsuicide$death/irlsuicide$pop~plot2age|irlsuicide$Region,
    pch=(1+(irlsuicide$sex==1)),xlab="age",ylab="Crude rates")

\end{ExampleCode}
\end{Examples}

\HeaderA{missouri}{Missouri lung cancer data}{missouri}
\keyword{datasets}{missouri}
\begin{Description}\relax
Lung cancer mortality in the 84 largest Missouri cities, for males aged 45-54, 1972-1981.
Data presented in Tsutakawa (1985).
\end{Description}
\begin{Usage}
\begin{verbatim}data(missouri)\end{verbatim}
\end{Usage}
\begin{Format}\relax
A data frame with 84 observations on the following 2 variables.
\describe{
\item[\code{Size}] population of the city.
\item[\code{Deaths}] number of lung cancer deaths.
}
\end{Format}
\begin{Details}\relax
The data set was analyzed using a Poisson model with normal random effect in
Tsutakawa (1985), and using a binomial logit model with unspecified random effect
distribution  in Aitkin (1996b). Aitkin fitted this model with GLIM4.
\end{Details}
\begin{Source}\relax
Tsutakawa, R. (1985).
\end{Source}
\begin{References}\relax
Aitkin, M. (1996b). Empirical Bayes shrinkage using posterior random effect means from nonparametric maximum likelihood estimation in general random effect models. Statistical Modelling: Proceedings of the 11th IWSM 1996, 87-94.

Tsutakawa, R. (1985). Estimation of Cancer Mortalilty Rates:
A Bayesian Analysis of Small Frequencies.  Biometrics 41, 69-79.
\end{References}
\begin{Examples}
\begin{ExampleCode}
data(missouri)
alldist(Deaths~1, offset=log(Size), random=~1, k=2,
   family=poisson(link='log'), data=missouri)
\end{ExampleCode}
\end{Examples}

\HeaderA{weightslogl.calc.w}{Internal npmlreg functions}{weightslogl.calc.w}
\aliasA{binomial.expand}{weightslogl.calc.w}{binomial.expand}
\aliasA{expand}{weightslogl.calc.w}{expand}
\methaliasA{expand.vc}{weightslogl.calc.w}{expand.vc}
\keyword{models}{weightslogl.calc.w}
\keyword{regression}{weightslogl.calc.w}
\begin{Description}\relax
These are not to be called by the user.
\end{Description}
\begin{Usage}
\begin{verbatim}
weightslogl.calc.w(p, fjk, weights)
expand(x, k)
expand.vc(x, ni)
binomial.expand(Y, k, w)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{p}] ...
\item[\code{fjk}] ...
\item[\code{weights}] ...
\item[\code{x}] ...
\item[\code{k}] ...
\item[\code{ni}] ...
\item[\code{Y}] ...
\item[\code{w}] ...
\end{ldescription}
\end{Arguments}
\begin{Author}\relax
Ross Darnell and Jochen Einbeck.
\end{Author}

\HeaderA{npmlreg-package}{Nonparametric maximum likelihood estimation for random effect models}{npmlreg.Rdash.package}
\aliasA{npmlreg}{npmlreg-package}{npmlreg}
\keyword{models}{npmlreg-package}
\keyword{regression}{npmlreg-package}
\begin{Description}\relax
Nonparametric maximum likelihood estimation or Gaussian quadrature
for overdispersed generalized linear models and variance component models.
The main functions  are \code{\LinkA{alldist}{alldist}} and \code{\LinkA{allvc}{allvc}}.
\end{Description}
\begin{Details}\relax
\Tabular{ll}{
Package: & npmlreg\\
Type: & Package\\
Version: & 0.37\\
Date: & 2006-08-14\\
License: & GPL version 2 or newer\\
}

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

For details on  the GNU General Public License
see \url{http://www.gnu.org/copyleft/gpl.html} or
write to the Free Software Foundation, Inc., 51 Franklin Street,
Fifth Floor, Boston, MA  02110-1301, USA.
\end{Details}
\begin{Section}{Acknowledgments}
This \R{} package is based on several GLIM4 macros originally written by
Murray Aitkin and Brian Francis.  The authors are also grateful to
Nick Sofroniou for retrieving the suicide data and providing the function \code{gqz}.

The work on this \R{} package was supported by Science
Foundation Ireland Basic Research Grant 04/BR/M0051.
\end{Section}
\begin{Author}\relax
Jochen Einbeck, Ross Darnell and John Hinde (2006).

Maintainer: Jochen Einbeck <jochen.einbeck@nuigalway.ie>
\end{Author}
\begin{References}\relax
Aitkin, M., Francis, B. and Hinde, J. (2005). Statistical Modelling in GLIM 4.
Second Edition, Oxford Statistical Science Series, Oxford, UK.

Einbeck, J., and Hinde, J. (2006). Nonparametric maximum likelihood estimation
for random effect models in \R. Vignette to \R{} package  \pkg{npmlreg}.
Type \code{vignette("npmlreg-v")} to open it.
\end{References}
\begin{SeeAlso}\relax
\code{\LinkA{glm}{glm}}
\end{SeeAlso}

\HeaderA{plot.glmmNPML}{Plot Diagnostics for objects of class glmmNPML or glmmGQ}{plot.glmmNPML}
\aliasA{plot.glmmGQ}{plot.glmmNPML}{plot.glmmGQ}
\keyword{models}{plot.glmmNPML}
\keyword{regression}{plot.glmmNPML}
\begin{Description}\relax
The functions \code{alldist}  and \code{allvc}   produce
objects of type \code{glmmGQ}, if Gaussian quadrature (Hinde, 1982,
\code{random.distribution="gq"}) was applied for computation, and  objects
of class \code{glmmNPML}, if parameter estimation was carried out by nonparametric
maximum likelihood (Aitkin, 1996a, \code{random.distribution="np"}).
The functions presented here give some useful diagnostic plotting functionalities
to analyze these objects.
\end{Description}
\begin{Usage}
\begin{verbatim}
plot.glmmNPML(x, plot.opt = 15, noformat=FALSE, ...)
plot.glmmGQ(x, plot.opt = 3, noformat=FALSE, ...)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{x}] a fitted object of class \code{glmmNPML} or \code{glmmGQ}.
\item[\code{plot.opt}] an integer with values \eqn{0 \le}{0 <=} \code{plot.opt} \eqn{\le 15}{<=15}.
\item[\code{noformat}] if \code{TRUE}, then any formatting of the plots is omitted (useful if the user wants to include the plots into a panel of several other plots, possibly generated by other functions).
\item[\code{...}] further arguments which will mostly not have any effect
(and are included only to ensure compatibility with the
generic \code{plot()}- function.)
\end{ldescription}
\end{Arguments}
\begin{Details}\relax
See the help pages to alldist and the vignette (Einbeck \& Hinde, 2006).
It is sufficient to write \code{plot} instead of \code{plot.glmmNPML} or \code{plot.glmmGQ},
since the generic \code{plot} function provided in \R{} automatically selects the right model class.
\end{Details}
\begin{Value}
For class \code{glmmNPML}: Depending on the choice of \code{plot.opt}, a subset
of the following four plots:


\begin{ldescription}
\item[\code{1}] Disparity trend.
\item[\code{2}] EM Trajectories.
\item[\code{3}] Empirical Bayes Predictions against observed response.
\item[\code{4}] Individual posterior probabilities.
\end{ldescription}


The number given in \code{plot.opt} is transformed into a binary
number indicating which plots are to be selected. The first digit
(from the right!) refers to plot 1, the second one to plot 2, and so on.
For example, \code{plot.opt=4} gives the binary number 0100 and hence selects
just plot 3.

For class \code{glmmGQ}: Depending on the choice of plot.opt,
a subset of  plots  1 and 3. Again, the number is transformed into binary coding, yielding only the
disparity trend for \code{plot.opt=1}, only the EBP's for \code{plot.opt=2},
and both plots for \code{plot.opt=3}.
\end{Value}
\begin{Author}\relax
Jochen Einbeck and John Hinde (2006)
\end{Author}
\begin{References}\relax
Aitkin, M. (1996a). A general maximum likelihood analysis of overdispersion in generalized linear models. Statistics and Computing 6, 251-262.

Einbeck, J., and Hinde, J. (2006). Nonparametric maximum likelihood estimation for random effect models in R. Vignette to R package  \pkg{npmlreg}.
Type \code{vignette("npmlreg-v")} to open it.

Hinde, J. (1982). Compound Poisson regression models. Lecture Notes in Statistics 14, 109-121.
\end{References}
\begin{SeeAlso}\relax
\code{\LinkA{alldist}{alldist}}, \code{\LinkA{allvc}{allvc}}
\end{SeeAlso}
\begin{Examples}
\begin{ExampleCode}

data(galaxies, package="MASS")
gal<-as.data.frame(galaxies)
galaxy.np4u <- alldist(galaxies/1000~1,random=~1,k=4,tol=0.5,data=gal,lambda=1)
predict(galaxy.np4u, type="response") # EBP on scale of responses

plot(galaxy.np4u,  plot.opt=4) # plots only EBP vs.  response
plot(galaxy.np4u,  plot.opt=3) # gives same output as given by default when executing alldist
plot(galaxy.np4u)              # gives all four plots.
\end{ExampleCode}
\end{Examples}

\HeaderA{post}{Posterior probabilities/intercepts, and mass point classifications}{post}
\keyword{models}{post}
\keyword{regression}{post}
\begin{Description}\relax
Takes an object of class \code{glmmNPML} or \code{glmmGQ} and displays the
posterior probabilites \eqn{w_{ik}}{w_ik} as well as  the posterior intercepts
(Sofroniou et. al, 2006). Further it classfies the observations to mass points
according to their  posterior probability. The level on which the information
in all three cases is displayed can be chosen by the user via the \code{level}
argument (\code{"upper"} or \code{"lower"}). The actual information in both cases is
identical, the latter is just an  expanded version of the former. In case of
simple overdispersion models, the  \code{level} argument is not relevant.
\end{Description}
\begin{Usage}
\begin{verbatim}
post(object, level="upper")
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{object}] an object of class \code{glmmNPML} or \code{glmmGQ}.
\item[\code{level}] \code{"upper"} or \code{"lower"}.
\end{ldescription}
\end{Arguments}
\begin{Value}
A list of the following four items:

\begin{ldescription}
\item[\code{prob}] posterior probabilities (identical to \code{object\$post.prob}
in case of \code{"lower"} and for one-level models).
\item[\code{int}] posterior intercepts (identical to \code{object\$post.int}
in case of \code{"lower"} and for one-level models).
\item[\code{classif}] a numerical vector containing the class numbers (the order of the classes corresponds to the
order of the mass points given in the output of \code{alldist} or \code{allvc}).
\item[\code{level}] either \code{"lower"}, \code{"upper"}, or \code{"none"} (for one-level models).
\end{ldescription}
\end{Value}
\begin{Author}\relax
Jochen Einbeck and John Hinde (2006)
\end{Author}
\begin{References}\relax
Sofroniou, N., Einbeck, J., and Hinde, J. (2006). Analyzing Irish suicide rates with mixture models. Proceedings of the 21st International Workshop on Statistical Modelling in Galway, Ireland, 2006.
\end{References}
\begin{SeeAlso}\relax
\code{\LinkA{alldist}{alldist}}, \code{\LinkA{allvc}{allvc}}
\end{SeeAlso}
\begin{Examples}
\begin{ExampleCode}
 data(galaxies, package="MASS")
 gal <- as.data.frame(galaxies)
 post(alldist(galaxies/1000~1, random=~1, data=gal, k=5))$classif
    # classifies the 82 galaxies to one of the five mass points
 \end{ExampleCode}
\end{Examples}

\HeaderA{predict.glmmNPML}{Prediction from objects of class glmmNPML or glmmGQ}{predict.glmmNPML}
\aliasA{predict.glmmGQ}{predict.glmmNPML}{predict.glmmGQ}
\keyword{models}{predict.glmmNPML}
\keyword{regression}{predict.glmmNPML}
\begin{Description}\relax
The functions \code{alldist} and \code{allvc} produce objects of type \code{glmmGQ},
if Gaussian quadrature (Hinde, 1982, \code{random.distribution="gq"} )
was applied for computation, and objects of class \code{glmmNPML}, if
parameter estimation was carried out by nonparametric maximum likelihood
(Aitkin, 1996a, \code{random.distribution="np"} ). The functions presented here
give predictions from those objects.
\end{Description}
\begin{Usage}
\begin{verbatim}
predict.glmmNPML(object, newdata, type = "link", ...)
predict.glmmGQ(object, newdata, type = "link", ...)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{object}] a fitted object of class \code{glmmNPML} or \code{glmmGQ}.
\item[\code{newdata}] a data frame with covariates from which prediction is desired.
If omitted, empirical Bayes predictions for the original data will be given.
\item[\code{type}] if set to \code{link}, the prediction is given on the linear predictor scale.
If set to \code{response}, prediction is given on the scale of the responses.
\item[\code{...}] further arguments which will mostly not have any effect (and are
included only to ensure compatibility
with the generic \code{predict()}- function.)
\end{ldescription}
\end{Arguments}
\begin{Details}\relax
The predicted values are obtained by

\Itemize{
\item Empirical Bayes (Aitkin, 1996b), if \code{newdata} has not been specified.
That is, the prediction on the linear predictor scale is given by
\eqn{\sum{\eta_{ik}w_{ik}} }{sum(eta_ik * w_ik)},
whereby \eqn{\eta_{ik}}{eta_ik} are the fitted linear predictors,
\eqn{w_{ik}}{w_ik} are the weights in the final iteration of the EM algorithm
(corresponding to the posterior probability for observation \eqn{i}{}
to come from component \eqn{k}{} ), and the sum is taken over the number
of components \eqn{k}{} for fixed \eqn{i}{}.
\item the marginal model, if object is of class \code{glmmNPML} and
\code{newdata} has been specified. That is, computation is identical as above, but
with \eqn{w_{ik}}{w_ik} replaced by the masses \eqn{\pi_k}{pi_k} of the fitted model.
\item the analytical expression for the marginal mean of the responses,
if object is of class \code{glmmGQ} and \code{newdata} has been specified.
See Aitkin et al. (2005), p. 459, for the formula. This method is only
supported for the logarithmic link function, as otherwise no analytical
expression for the marginal mean of the responses exists.
}
It is sufficient to write \code{predict} instead of \code{predict.glmmNPML} or
\code{predict.glmmGQ}, since the generic predict function provided in \R{} automatically selects the right
model class.
\end{Details}
\begin{Value}
A vector of predicted values.
\end{Value}
\begin{Section}{Note}
The results of the generic \code{fitted()} method
correspond to \code{predict(object, type="response")}.  Note that, as we are
working with random effects, fitted values are never really `fitted' but rather
`predicted'.
\end{Section}
\begin{Author}\relax
Jochen Einbeck and John Hinde (2006).
\end{Author}
\begin{References}\relax
Aitkin, M. (1996a). A general maximum likelihood analysis of overdispersion in generalized linear models. Statistics and Computing 6, 251-262.

Aitkin, M. (1996b). Empirical Bayes shrinkage using posterior random effect means from nonparametric maximum likelihood estimation in general random effect models. Statistical Modelling: Proceedings of the 11th IWSM 1996, 87-94.

Aitkin, M., Francis, B. and Hinde, J. (2005). Statistical Modelling in GLIM 4. Second Edition, Oxford Statistical Science Series, Oxford, UK.

Hinde, J. (1982). Compound Poisson regression models. Lecture Notes in Statistics 14, 109-121.
\end{References}
\begin{SeeAlso}\relax
\code{\LinkA{alldist}{alldist}}, \code{\LinkA{allvc}{allvc}}, \code{\LinkA{predict}{predict}}
\end{SeeAlso}
\begin{Examples}
\begin{ExampleCode}
 # Toxoplasmosis data:
    data(rainfall, package="forward")
    rainfall$x<-rainfall$Rain/1000
    toxo.0.3x<- alldist(cbind(Cases,Total-Cases)~1, random=~x,
          data=rainfall, k=3, family=binomial(link=logit))
    toxo.1.3x<- alldist(cbind(Cases,Total-Cases)~x, random=~x,
          data=rainfall, k=3, family=binomial(link=logit))
    predict(toxo.0.3x, type="response", newdata=data.frame(x=2))
    # [1] 0.4608
    predict(toxo.1.3x, type="response", newdata=data.frame(x=2))
    # [1] 0.4608
    # gives the same result, as both models are equivalent and only differ
    # by a  parameter transformation.

# Fabric faults data:
    data(fabric, package="gamlss")
    names(fabric)
    # [1] "leng" "y"    "x"
    faults.g2<- alldist(y ~ x, family=poisson(link=log), random=~1,
        data= fabric,k=2, random.distribution="gq")
    predict(faults.g2, type="response",newdata=fabric[1:6,])
    # [1]  8.715805 10.354556 13.341242  5.856821 11.407828 13.938013
    # is not the same as
    predict(faults.g2, type="response")[1:6]
    # [1]  6.557786  7.046213 17.020242  7.288989 13.992591  9.533823
    # since in the first case prediction is done using the analytical
    # mean of the marginal distribution, and in the second case  using the
    # individual posterior probabilities in an  empirical Bayes approach.

\end{ExampleCode}
\end{Examples}

\HeaderA{summary.glmmNPML}{Summarizing finite mixture regression fits}{summary.glmmNPML}
\aliasA{print.glmmGQ}{summary.glmmNPML}{print.glmmGQ}
\aliasA{print.glmmNPML}{summary.glmmNPML}{print.glmmNPML}
\aliasA{summary.glmmGQ}{summary.glmmNPML}{summary.glmmGQ}
\keyword{models}{summary.glmmNPML}
\keyword{regression}{summary.glmmNPML}
\begin{Description}\relax
These functions are the \code{summary} and \code{print} methods for objects of  type
\code{glmmNPML} and \code{glmmGQ}.
\end{Description}
\begin{Usage}
\begin{verbatim}
summary.glmmNPML(object, digits = max(3, getOption("digits") - 3), ...)
summary.glmmGQ(object, digits = max(3, getOption("digits") - 3), ...)

print.glmmNPML(x, digits=max(3,getOption('digits')-3), ...)
print.glmmGQ(x, digits=max(3,getOption('digits')-3),  ...)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{object}] a fitted object of class \code{glmmNPML} or \code{glmmGQ}.
\item[\code{x}] a fitted object of class \code{glmmNPML} or \code{glmmGQ}.
\item[\code{digits}] number of digits; applied on various displayed quantities.
\item[\code{...}] further arguments, which will mostly be ignored.
\end{ldescription}
\end{Arguments}
\begin{Details}\relax
The \code{summary...}- and \code{print...} -functions invoke the generic
\code{UseMethod(...)} function and pick the summary for the right model class
automatically.

A summary of the \code{glm} fitted in the last EM iteration is available via
\code{summary(object)\$lastglmsumm}.
\end{Details}
\begin{Value}
Print or Summary.

Objects returned by \code{summary.glmmNPML}  or  \code{summary.glmmGQ} are identical
to objects of class \code{glmmNPML} or \code{glmmGQ}, but have two additional components
\code{\$dispersion} and \code{\$lastglmsumm} providing the estimated dispersion parameter and a summary
of the \code{glm} fitted in the last EM iteration.
\end{Value}
\begin{Author}\relax
originally from Ross Darnell (2002), modified and prepared for
publication by Jochen Einbeck and John Hinde (2006).
\end{Author}
\begin{SeeAlso}\relax
\code{\LinkA{alldist}{alldist}}, \code{\LinkA{allvc}{allvc}}, \code{\LinkA{summary}{summary}},
\code{\LinkA{print}{print}}, \code{\LinkA{family.glmmNPML}{family.glmmNPML}}
\end{SeeAlso}

\HeaderA{tolfind}{Grid search over tol for NPML estimation of (generalized) random effect models}{tolfind}
\keyword{models}{tolfind}
\keyword{regression}{tolfind}
\begin{Description}\relax
Performs a grid search to select the parameter  \code{tol},
which is a tuning parameter for starting point selection of the EM algorithm
for NPML estimation (see e.g. Aitkin, Hinde \& Francis, 2005, p. 418)
\end{Description}
\begin{Usage}
\begin{verbatim}
tolfind(formula,
        random = ~1,
        family = gaussian(),
        data,
        k = 4,
        random.distribution="np",
        offset,
        weights,
        na.action,
        EMmaxit = 500,
        EMdev.change = 0.001,
        lambda = 0,
        damp = TRUE,
        damp.power = 1,
        spike.protect = 1,
        sdev,
        shape,
        plot.opt = 1,
        steps = 15,
        find.in.range = c(0.05, 0.8),
        verbose = FALSE,
        noformat = FALSE,
        ...)
\end{verbatim}
\end{Usage}
\begin{Arguments}
\begin{ldescription}
\item[\code{formula}] a formula defining the response and the fixed effects (e.g. \code{y \textasciitilde{} x}).
\item[\code{random}] a formula defining the random model. Set \code{random=\textasciitilde{}1}
to model overdispersion.
\item[\code{family}] conditional distribution of responses. "gaussian", "poisson", "binomial", or "Gamma" can be set.
\item[\code{data}] the data frame (mandatory, even if it is attached to the workspace!).
\item[\code{k}] the number of mass points/integration points (supported are
up to 30 mass points).
\item[\code{random.distribution}] the mixing distribution, Gaussian Quadrature
(\code{gq}) or NPML (\code{np}) can be set.
\item[\code{offset}] an optional offset to be included in the model.
\item[\code{weights}] optional prior weights for the data.
\item[\code{na.action}] a function indicating what should happen when \code{NA}'s occur,
with possible arguments \code{na.omit} and \code{na.fail}. The default is
set by the \code{na.action} setting in \code{options()} .
\item[\code{EMmaxit}] maximum number of EM iterations.
\item[\code{EMdev.change}] stops EM algorithm when deviance change falls below this value.
\item[\code{lambda}] see the help file for \code{alldist}.
\item[\code{damp}] switches EM damping on or off.
\item[\code{damp.power}] steers degree of damping.
\item[\code{spike.protect}] see the help file for \code{alldist}. For unequal or
smooth component dispersion parameters, the setting \code{spike.protect=1}
is strongly recommended.
\item[\code{sdev}] optional fixed standard deviation for normal mixture.
\item[\code{shape}] optional fixed shape parameter for Gamma mixture.
\item[\code{plot.opt}] For \code{plot.opt=1} the EM trajectories are plotted,
for \code{plot.opt=2} the development of the disparity \eqn{-2\log L}{-2logL} over
iteration number is plotted, for \code{plot.opt=3} both plots are shown,
and for \code{plot.opt=0} none of them.
\item[\code{steps}] number of grid points for the search of \code{tol}.
\item[\code{find.in.range}] range for the search of \code{tol}.
\item[\code{verbose}] If set to \code{FALSE}, no printed output is given during
execution of \code{alldist} or \code{allvc}.
\item[\code{noformat}] If \code{TRUE}, then any formatting of the plots is omitted.
\item[\code{...}] further arguments which will be ignored.
\end{ldescription}
\end{Arguments}
\begin{Details}\relax
The EM algorithm for NPML estimation (Aitkin, 1996) uses the Gauss-Hermite masses
and mass points as starting  points. The position of the starting points can be
concentrated or extended by setting \code{tol} smaller or larger than 1,
respectively. The tuning parameter \code{tol} is, as in GLIM4, responsible for this scaling.
A careful selection of \code{tol} may be necessary for some data sets.
The reason  is that NPML has a tendency to get stuck in local maxima,
as the log-likelihhod function is not concave for fixed \code{k}  (Boehning, 1999).

For Gaussian and Gamma mixtures this R implementation uses by default a damping
procedure  in the first cycles of the EM algorithm (Einbeck \& Hinde, 2006),
which stabilizes the algorithm and  makes it less sensitive to the optimal choice
of \code{tol}.  Application of  \code{tolfind} to check that the optimal  solution has
not been overlooked may  nevertheless be advisable.

\code{tolfind} works for \code{alldist} and \code{allvc}. The \code{tolfind} function
is mainly designed for NPML (\code{random.distribution="np"}). It
can also be applied to Gaussian Quadrature (\code{random.distribution="gq"}),
though \code{tol} is of little importance for this and primarily influences
the speed of convergence.
\end{Details}
\begin{Value}
A list of 5 items:

\begin{ldescription}
\item[\code{MinDisparity}] the minimal disparity achieved (for which EM converged).
\item[\code{Mintol}] the \code{tol} value at which this disparity is achieved.
\item[\code{AllDisparities}] a vector containing all disparities calculated on the grid.
\item[\code{Alltol}] all corresponding \code{tol} values making up the grid.
\item[\code{AllEMconverged}] a vector of Booleans indicating
if EM converged for the particular \code{tol} values.
\end{ldescription}
\end{Value}
\begin{Author}\relax
Jochen Einbeck \& John Hinde (2006).
\end{Author}
\begin{References}\relax
Aitkin, M. (1996). A general maximum likelihood analysis of overdispersion in generalized linear models. Statistics and Computing 6 , 251-262.

Aitkin, M., Francis, B. and Hinde, J. (2005). Statistical Modelling in GLIM 4. Second Edition, Oxford Statistical Science Series, Oxford, UK.

Bhning, D. (1999). Computer-Assisted Analysis of Mixtures and Applications. Meta-Analysis, Disease Mapping and others. Chapman \& Hall / CRC, Boca Raton, FL, USA.

Einbeck, J. \& Hinde, J. (2006). A note on NPML estimation for exponential family regression models with unspecified dispersion parameter. Austrian Journal of Statistics 35, 233-243.
\end{References}
\begin{SeeAlso}\relax
\code{\LinkA{alldist}{alldist}}, \code{\LinkA{allvc}{allvc}}
\end{SeeAlso}
\begin{Examples}
\begin{ExampleCode}
  data(galaxies, package="MASS")
  gal<-as.data.frame(galaxies)
  tolfind(galaxies/1000~1, random=~1, k=5, data=gal, lambda=1, damp=TRUE,
      find.in.range=c(0,1), steps=10)
  # Minimal Disparity: 380.1444 at tol= 0.5
 \end{ExampleCode}
\end{Examples}

\end{document}
